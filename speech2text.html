<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>speech2text.html</title>
</head>

<script src={{ url_for('static', filename='js/recorder.mp3.min.js') }}></script>
<script>
    function __log(e, data) {
        log.innerHTML += "\n" + e + " " + (data || '');
    }
    var rec=Recorder();//使用默认配置，mp3格式
    /*
    function startRecord(button) {
        rec.open();
        rec.start();
        button.disabled = true;
        button.nextElementSibling.disabled = false;
        __log('录制中...');
    }
    function stopRecord(button) {
        rec.stop();
        rec.close();
        button.disabled = true;
        button.nextElementSibling.disabled = false;
        __log('停止 录制.');

    }
    function playRecord(button) {
        rec.play();
    }
    function speech2text(button){

    }
*/
    rec.open(function(){//打开麦克风授权获得相关资源
    rec.start();//开始录音
    __log('Starting...');
    setTimeout(function(){
        rec.stop(function(blob,duration){//到达指定条件停止录音
            console.log(URL.createObjectURL(blob),"时长:"+duration+"ms");
            rec.close();//释放录音资源
            __log('End.');
            //已经拿到blob文件

            // 立即播放例子
            var audio=document.createElement("audio");
            audio.controls=true;
            document.body.appendChild(audio);
            audio.src=URL.createObjectURL(blob);
            audio.play();

        },function(msg){
            console.log("录音失败:"+msg);
        });
    },3000);
},function(msg,isUserNotAllow){//用户拒绝未授权或不支持
    console.log((isUserNotAllow?"UserNotAllow，":"")+"无法录音:"+msg);
});

</script>


<body>

<div>
    <p>Speech To Text</p>
    <!--
    <button type="button" onclick=startRecord(this)>Start Record</button>&nbsp;&nbsp;
    <button type="button" onclick=stopRecord(this)>Stop Record</button>
    -->
</div>

<div>
    <!--
    <button type="button" onclick=playRecord(this)>Play the Record</button><br/>
    <button type="button" onclick=speech2text(this)>Speech To Text</button>
    <p>Result</p>
    <p id="text"></p>
    -->
    <h2>Log</h2>
    <pre id="log"></pre>
</div>
</body>
</html>